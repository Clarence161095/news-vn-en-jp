{% extends "base.html" %}

{% block title %}Import JSON - Äá»c BÃ¡o{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
    <a href="{{ url_for('index') }}" style="color: #3498db; text-decoration: none;">â† Quay láº¡i danh sÃ¡ch</a>
</div>

<div class="card">
    <h2 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“¥ Import BÃ i Viáº¿t tá»« JSON</h2>
    
    <form method="POST" id="importForm" style="display: flex; flex-direction: column; gap: 15px;">
        <div>
            <label for="json_data" style="display: block; margin-bottom: 10px; font-weight: bold;">
                DÃ¡n JSON cá»§a báº¡n vÃ o Ä‘Ã¢y:
            </label>
            <textarea 
                name="json_data" 
                id="json_data" 
                rows="20" 
                style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 0.9em;"
                placeholder='VÃ­ dá»¥:
{
    "title_vi": "TiÃªu Ä‘á» tiáº¿ng Viá»‡t",
    "title_en": "English Title",
    "content_vi": "Ná»™i dung tiáº¿ng Viá»‡t...",
    "content_en": "English content...",
    "category": "news"
}

Hoáº·c import nhiá»u bÃ i viáº¿t:
[
    { ... bÃ i viáº¿t 1 ... },
    { ... bÃ i viáº¿t 2 ... }
]'
            ></textarea>
        </div>
        
        <!-- Hidden input for username -->
        <input type="hidden" name="username" id="usernameInput" value="">
        
        <button 
            type="submit" 
            style="padding: 15px 30px; background-color: #2ecc71; color: white; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; transition: background-color 0.3s;"
            onmouseover="this.style.backgroundColor='#27ae60'"
            onmouseout="this.style.backgroundColor='#2ecc71'"
        >
            âœ… Import BÃ i Viáº¿t
        </button>
    </form>
    
    <script>
        // FORCE username check and auto-fill before form submit
        document.getElementById('importForm').addEventListener('submit', function(e) {
            e.preventDefault(); // STOP form submission first
            
            // Get username directly from localStorage (more reliable)
            const username = localStorage.getItem('username');
            
            console.log('ğŸ“¤ Form submit - checking username...');
            console.log('ğŸ‘¤ Username from localStorage:', username);
            
            if (!username || username.trim() === '') {
                console.log('âŒ NO USERNAME - blocking import');
                alert('âš ï¸ Báº®T BUá»˜C: Báº¡n PHáº¢I Ä‘áº·t tÃªn ngÆ°á»i dÃ¹ng trÆ°á»›c khi import!\n\n' +
                      'BÃ i viáº¿t sáº½ khÃ´ng cÃ³ category cá»§a báº¡n vÃ  báº¡n sáº½ khÃ´ng thá»ƒ xÃ³a Ä‘Æ°á»£c.\n\n' +
                      'ğŸ‘‰ Nháº¥n vÃ o biá»ƒu tÆ°á»£ng ğŸ‘¤ á»Ÿ gÃ³c trÃªn Ä‘á»ƒ Ä‘áº·t tÃªn.');
                return false; // BLOCK submission
            }
            
            // Set username to hidden input
            document.getElementById('usernameInput').value = username.trim();
            console.log('âœ… Set hidden input value:', document.getElementById('usernameInput').value);
            console.log('âœ… Submitting form with username:', username);
            
            // NOW submit the form
            e.target.submit();
        });
        
        // Also show username reminder on page load
        window.addEventListener('DOMContentLoaded', function() {
            const username = localStorage.getItem('username');
            if (!username || username.trim() === '') {
                const reminder = document.createElement('div');
                reminder.style = 'position: fixed; top: 80px; right: 20px; background: #ff9800; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); z-index: 1000; max-width: 300px;';
                reminder.innerHTML = 'âš ï¸ <strong>ChÆ°a cÃ³ username!</strong><br>Vui lÃ²ng Ä‘áº·t tÃªn trÆ°á»›c khi import.';
                document.body.appendChild(reminder);
                
                setTimeout(() => reminder.remove(), 5000);
            }
        });
    </script>
    
    <div style="margin-top: 30px; padding: 20px; background-color: #f9f9f9; border-radius: 5px;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“– HÆ°á»›ng dáº«n Ä‘á»‹nh dáº¡ng JSON:</h3>
        <ul style="line-height: 2;">
            <li><strong>title_vi:</strong> TiÃªu Ä‘á» tiáº¿ng Viá»‡t</li>
            <li><strong>title_en:</strong> TiÃªu Ä‘á» tiáº¿ng Anh</li>
            <li><strong>content_vi:</strong> Ná»™i dung tiáº¿ng Viá»‡t (cÃ³ thá»ƒ chá»©a HTML)</li>
            <li><strong>content_en:</strong> Ná»™i dung tiáº¿ng Anh</li>
            <li><strong>category:</strong> Danh má»¥c (news, book, article, v.v.)</li>
        </ul>
        
        <h4 style="color: #2c3e50; margin-top: 20px; margin-bottom: 10px;">ğŸ’¡ IPA tá»± Ä‘á»™ng:</h4>
        <p style="line-height: 1.8;">
            IPA (International Phonetic Alphabet) sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng táº¡o cho ná»™i dung tiáº¿ng Anh khi báº¡n xem bÃ i viáº¿t.
            KhÃ´ng cáº§n thÃªm thá»§ cÃ´ng vÃ o JSON.
        </p>
        
        <h4 style="color: #2c3e50; margin-top: 20px; margin-bottom: 10px;">ğŸ“š Tráº¡ng thÃ¡i thÆ° viá»‡n:</h4>
        <ul style="line-height: 2;">
            <li><strong>IPA (eng-to-ipa):</strong> {{ lib_status.ipa }}</li>
        </ul>
    </div>
</div>
{% endblock %}
